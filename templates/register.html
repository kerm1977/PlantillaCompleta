{% extends 'base.html' %}

{% block title %}Registro{% endblock %}

{% block content %}
<style>
    /* Eliminar sombras y bordes de la tarjeta principal */
    .card.shadow.p-4 {
        box-shadow: none !important;
        border: none !important;
        background-color: transparent !important; /* Opcional: para que no tenga fondo blanco de tarjeta */
    }

    /* Eliminar bordes del input-group */
    .input-group > .form-control,
    .input-group > .btn {
        border-color: #ced4da !important; /* Mantener un borde sutil si lo deseas, o 'none' */
    }

    /* Ajustes adicionales si se desea que los campos y botones también pierdan "efectos card" */
    .form-control {
        border-radius: 0 !important; /* Bordes cuadrados en lugar de redondeados */
    }

    .btn {
        border-radius: 0 !important; /* Bordes cuadrados en los botones */
        box-shadow: none !important; /* Eliminar sombras de botones si las tuvieran */
    }
</style>

<div class="row justify-content-center">
    <div class="col-md-8 col-lg-7">
        <div class="card shadow p-4 mt-5">
            <h2 class="text-center text-warning mb-4">Registro de Usuario</h2>
            <form method="POST" action="{{ url_for('register') }}" enctype="multipart/form-data">
                
                <p class="text-muted text-center">Los campos marcados con * son obligatorios.</p>

                <!-- Avatar Imagen -->
                <div class="mb-3">
                    <label for="avatar" class="form-label">Avatar (Opcional)</label>
                    <input class="form-control" type="file" id="avatar" name="avatar" accept="image/*">
                    <div class="form-text">Sube tu imagen de perfil. Se usará una por defecto si no subes una.</div>
                </div>

                <!-- Nombre -->
                <div class="mb-3">
                    <label for="nombre" class="form-label">Nombre *</label>
                    <input type="text" class="form-control" id="nombre" name="nombre" value="{{ request.form.get('nombre', '') | title }}" required>
                </div>

                <!-- Primer Apellido -->
                <div class="mb-3">
                    <label for="primer_apellido" class="form-label">Primer Apellido *</label>
                    <input type="text" class="form-control" id="primer_apellido" name="primer_apellido" value="{{ request.form.get('primer_apellido', '') | title }}" required>
                </div>

                <!-- Segundo Apellido (Opcional) -->
                <div class="mb-3">
                    <label for="segundo_apellido" class="form-label">Segundo Apellido (Opcional)</label>
                    <input type="text" class="form-control" id="segundo_apellido" name="segundo_apellido" value="{{ request.form.get('segundo_apellido', '') | title }}">
                </div>

                <!-- Email (Requerido) -->
                <div class="mb-3">
                    <label for="email" class="form-label">Email *</label>
                    <input type="email" class="form-control" id="email" name="email" value="{{ request.form.get('email', '') }}" required>
                </div>

                <!-- Usuario de Registro (obligatorio) -->
                <div class="mb-3">
                    <label for="username_registro" class="form-label">Usuario de Registro *</label>
                    <input type="text" class="form-control" id="username_registro" name="username_registro" value="{{ request.form.get('username_registro', '') }}" required>
                </div>

                <!-- Password (obligatorio) -->
                <div class="mb-3">
                    <label for="password" class="form-label">Contraseña *</label>
                    <div class="input-group">
                        <input type="password" class="form-control" id="password" name="password" required>
                        <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <!-- Confirmar Password (obligatorio) -->
                <div class="mb-3">
                    <label for="confirm_password" class="form-label">Confirmar Contraseña *</label>
                    <div class="input-group">
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                        <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <!-- Teléfono (obligatorio) -->
                <div class="mb-3">
                    <label for="telefono" class="form-label">Teléfono *</label>
                    <input type="tel" class="form-control" id="telefono" name="telefono" value="{{ request.form.get('telefono', '') }}" required>
                </div>

                <!-- CAMPOS ELIMINADOS DEL REGISTRO -->
                <!-- 
                    Teléfono de Emergencia, Nombre de Contacto de Emergencia, Empresa, Cédula,
                    Provincia, Fecha de Cumpleaños, Tipo de Sangre, Póliza, Aseguradora,
                    Alergias, Enfermedades Crónicas, Actividad, Capacidad, Participación
                    han sido removidos de esta vista para simplificar el registro.
                    Estos campos se gestionan en la pantalla de "Editar Contacto".
                -->

                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-warning">Registrarse</button>
                </div>
                <p class="text-center mt-3">¿Ya tienes una cuenta? <a href="{{ url_for('login') }}">Inicia Sesión</a></p>
            </form>
        </div>
    </div>
</div>

<!-- Script JavaScript para la funcionalidad de mostrar/ocultar contraseña -->
<script>
    // Función genérica para alternar visibilidad de contraseña
    function setupPasswordToggle(toggleButtonId, passwordInputId) {
        const toggleButton = document.querySelector(toggleButtonId);
        const passwordInput = document.querySelector(passwordInputId);

        if (toggleButton && passwordInput) {
            toggleButton.addEventListener('click', function (e) {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.querySelector('i').classList.toggle('fa-eye');
                this.querySelector('i').classList.toggle('fa-eye-slash');
            });
        }
    }

    // Configurar para el campo de 'Contraseña'
    setupPasswordToggle('#togglePassword', '#password');
    // Configurar para el campo de 'Confirmar Contraseña'
    setupPasswordToggle('#toggleConfirmPassword', '#confirm_password');
</script>

{% endblock %}

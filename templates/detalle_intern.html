<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador, Facturador y Planificador</title>
    
    <!-- Tailwind CSS para estilos rápidos y responsivos -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Manifest JSON embebido para la funcionalidad PWA -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIkhlcnJhbWllbnRhIGRlIENvdGl6YWNpw7NuIiwKICAic2hvcnRfbmFtZSI6ICJDdWFkcm8gQXBwIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9wbGFjZWhvbGQuY28vMTkyeDE5Mi8zMTgzOTgvZmZmZmZmP3RleHQ9QXBwIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiCiAgICB9LAogICAgewogICAgICAic3JjIjogImh0dHBzOi8vcGxhY2Vob2xkLmNvLzUxMng1MTIvMzE4Mzk4L2ZmZmZmZj90ZXh0PUFwcCIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIgogICAgfQogIF0sCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAidGhlbWVfY29sb3IiOiAiIzMxODM5OCIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIKfQo=">
    
    <!-- Meta tags para PWA en iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cuadro App">

    <style>
        /* Estilos personalizados y para impresión */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-active {
            border-color: #4f46e5;
            color: #4f46e5;
            background-color: #eef2ff;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #print-area, #print-area * {
                visibility: visible;
            }
            #print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8 no-print">
            <h1 class="text-4xl font-bold text-gray-700">Herramienta de Gestión</h1>
            <p class="text-gray-500">Crea cotizaciones, facturas y planifica tus tareas.</p>
        </header>

        <!-- Navegación de Pestañas -->
        <div class="mb-6 border-b border-gray-200 no-print">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                <button onclick="showTab('quotes')" class="tab tab-active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Cotizaciones</button>
                <button onclick="showTab('invoices')" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">Facturas</button>
                <button onclick="showTab('planning')" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">Planificación</button>
            </nav>
        </div>

        <main>
            <!-- Sección de Cotizaciones -->
            <div id="quotes" class="tab-content bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4">Nueva Cotización</h2>
                <div id="print-area-quotes">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="quote-client" class="block text-sm font-medium text-gray-700">Nombre del Cliente</label>
                            <input type="text" id="quote-client" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Ej: Juan Pérez">
                        </div>
                        <div>
                            <label for="quote-date" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="quote-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24">Cant.</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Precio Unit.</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Total</th>
                                    <th class="w-10 no-print"></th>
                                </tr>
                            </thead>
                            <tbody id="quote-items" class="bg-white divide-y divide-gray-200">
                                <!-- Filas de items se agregarán aquí -->
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addItem('quote')" class="mt-4 text-sm text-yellow-600 hover:text-yellow-700 font-semibold no-print">+ Agregar línea</button>
                    
                    <div class="mt-6 flex justify-end">
                        <div class="w-full max-w-xs">
                            <div class="flex justify-between py-1">
                                <span>Subtotal</span>
                                <span id="quote-subtotal">$0.00</span>
                            </div>
                            <div class="flex justify-between py-1">
                                <span>Impuestos (10%)</span>
                                <span id="quote-tax">$0.00</span>
                            </div>
                            <div class="border-t mt-2 pt-2 flex justify-between font-bold text-lg">
                                <span>Total</span>
                                <span id="quote-total">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 text-right no-print">
                    <button onclick="printContent('quotes')" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-yellow-500 hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
                        Imprimir / Guardar PDF
                    </button>
                </div>
            </div>

            <!-- Sección de Facturas -->
            <div id="invoices" class="tab-content bg-white p-6 rounded-lg shadow-md hidden">
                <h2 class="text-2xl font-semibold mb-4">Nueva Factura</h2>
                 <div id="print-area-invoices">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="invoice-client" class="block text-sm font-medium text-gray-700">Nombre del Cliente</label>
                            <input type="text" id="invoice-client" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Ej: Ana Gómez">
                        </div>
                        <div>
                            <label for="invoice-date" class="block text-sm font-medium text-gray-700">Fecha</label>
                            <input type="date" id="invoice-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24">Cant.</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Precio Unit.</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Total</th>
                                    <th class="w-10 no-print"></th>
                                </tr>
                            </thead>
                            <tbody id="invoice-items" class="bg-white divide-y divide-gray-200">
                                <!-- Filas de items se agregarán aquí -->
                            </tbody>
                        </table>
                    </div>
                    <button onclick="addItem('invoice')" class="mt-4 text-sm text-yellow-600 hover:text-yellow-700 font-semibold no-print">+ Agregar línea</button>
                    
                    <div class="mt-6 flex justify-end">
                        <div class="w-full max-w-xs">
                            <div class="flex justify-between py-1">
                                <span>Subtotal</span>
                                <span id="invoice-subtotal">$0.00</span>
                            </div>
                            <div class="flex justify-between py-1">
                                <span>Impuestos (10%)</span>
                                <span id="invoice-tax">$0.00</span>
                            </div>
                            <div class="border-t mt-2 pt-2 flex justify-between font-bold text-lg">
                                <span>Total</span>
                                <span id="invoice-total">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 text-right no-print">
                    <button onclick="printContent('invoices')" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-yellow-500 hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
                        Imprimir / Guardar PDF
                    </button>
                </div>
            </div>

            <!-- Sección de Planificación -->
            <div id="planning" class="tab-content bg-white p-6 rounded-lg shadow-md hidden">
                <h2 class="text-2xl font-semibold mb-4">Planificador de Tareas</h2>
                <div class="flex gap-2 mb-4">
                    <input type="text" id="new-task-input" class="flex-grow block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Escribe una nueva tarea...">
                    <button onclick="addTask()" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-yellow-500 hover:bg-yellow-600">Agregar</button>
                </div>
                <ul id="task-list" class="space-y-3">
                    <!-- Tareas se agregarán aquí -->
                </ul>
            </div>
        </main>

    </div>

    <script>
        // --- Lógica del Service Worker para PWA ---
        if ('serviceWorker' in navigator) {
            const swContent = `
                const CACHE_NAME = 'cuadro-app-cache-v1';
                const urlsToCache = [
                    '/',
                ];

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => {
                                console.log('Opened cache');
                                // Cache the main page itself. The path '/' should work for index.html
                                return cache.add(location.pathname);
                            })
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => {
                                if (response) {
                                    return response;
                                }
                                return fetch(event.request);
                            })
                    );
                });
            `;
            const swBlob = new Blob([swContent], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(swBlob);

            navigator.serviceWorker.register(swUrl)
                .then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                })
                .catch(error => {
                    console.log('ServiceWorker registration failed: ', error);
                });
        }

        // --- Lógica de la Aplicación ---

        // Navegación por pestañas
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        function showTab(tabId) {
            tabs.forEach(tab => {
                tab.classList.remove('tab-active');
            });
            event.target.classList.add('tab-active');

            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tabId).classList.remove('hidden');
        }
        
        // Lógica para Cotizaciones y Facturas
        function addItem(type) {
            const itemsContainer = document.getElementById(`${type}-items`);
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <input type="text" class="w-full border-gray-300 rounded-md shadow-sm text-sm" placeholder="Descripción del servicio">
                </td>
                <td class="px-6 py-4">
                    <input type="number" value="1" min="1" class="w-full border-gray-300 rounded-md shadow-sm text-sm quantity" oninput="calculateTotals('${type}')">
                </td>
                <td class="px-6 py-4">
                    <input type="number" value="0" min="0" step="0.01" class="w-full border-gray-300 rounded-md shadow-sm text-sm price" oninput="calculateTotals('${type}')">
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 item-total">$0.00</td>
                <td class="px-6 py-4 text-right text-sm font-medium no-print">
                    <button onclick="removeItem(this, '${type}')" class="text-red-600 hover:text-red-900">X</button>
                </td>
            `;
            itemsContainer.appendChild(row);
            calculateTotals(type);
        }

        function removeItem(button, type) {
            button.closest('tr').remove();
            calculateTotals(type);
        }

        function calculateTotals(type) {
            let subtotal = 0;
            const items = document.querySelectorAll(`#${type}-items tr`);
            items.forEach(row => {
                const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                const price = parseFloat(row.querySelector('.price').value) || 0;
                const total = quantity * price;
                row.querySelector('.item-total').textContent = formatCurrency(total);
                subtotal += total;
            });

            const tax = subtotal * 0.10; // 10% de impuestos
            const total = subtotal + tax;

            document.getElementById(`${type}-subtotal`).textContent = formatCurrency(subtotal);
            document.getElementById(`${type}-tax`).textContent = formatCurrency(tax);
            document.getElementById(`${type}-total`).textContent = formatCurrency(total);
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
        }
        
        function printContent(type) {
            const printAreaId = `print-area-${type === 'quotes' ? 'quotes' : 'invoices'}`;
            const printArea = document.getElementById(printAreaId);
            const originalContent = document.body.innerHTML;
            const printContent = printArea.innerHTML;
            
            // Crear un clon para no afectar el original
            const tempDiv = document.createElement('div');
            tempDiv.id = 'print-area';
            tempDiv.innerHTML = printContent;
            
            // Ocultar el cuerpo original y agregar el área de impresión
            document.body.innerHTML = '';
            document.body.appendChild(tempDiv);
            
            window.print();
            
            // Restaurar el contenido original
            document.body.innerHTML = originalContent;
            // Re-adjuntar los event listeners que se perdieron
            reinitializeEventListeners();
        }

        function reinitializeEventListeners() {
            // Esta función es un placeholder. En una app compleja, necesitarías volver a
            // adjuntar todos los listeners. Para esta app simple, un reload es más fácil
            // y asegura que todo funcione después de imprimir.
            window.location.reload();
        }


        // Lógica de Planificación
        const taskInput = document.getElementById('new-task-input');
        const taskList = document.getElementById('task-list');

        function addTask() {
            const taskText = taskInput.value.trim();
            if (taskText === '') return;

            const listItem = document.createElement('li');
            listItem.className = 'flex items-center justify-between bg-gray-50 p-3 rounded-md';
            listItem.innerHTML = `
                <span class="task-text">${taskText}</span>
                <div>
                    <button onclick="toggleTask(this)" class="text-green-500 hover:text-green-700 mr-2">✓</button>
                    <button onclick="deleteTask(this)" class="text-red-500 hover:text-red-700">X</button>
                </div>
            `;
            taskList.appendChild(listItem);
            taskInput.value = '';
        }

        function toggleTask(button) {
            const taskText = button.closest('li').querySelector('.task-text');
            taskText.classList.toggle('line-through');
            taskText.classList.toggle('text-gray-400');
        }

        function deleteTask(button) {
            button.closest('li').remove();
        }
        
        taskInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                addTask();
            }
        });

        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('quote-date').valueAsDate = new Date();
            document.getElementById('invoice-date').valueAsDate = new Date();
            addItem('quote');
            addItem('invoice');
        });

    </script>
</body>
</html>

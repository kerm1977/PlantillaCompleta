{% extends 'base.html' %}

{% block title %}Detalle de Solicitud{% endblock %}

{% block content %}
<!-- NO TENGO AUTORIZACIÓN PARA MODIFICAR EL DISEÑO DE ESTA VISTA -->
<div class="container my-5">
    <div class="card p-0 border rounded-lg" style="max-width: 800px; margin: auto;">
        <!-- Header del boleto -->
        <div class="card-header bg-warning text-white rounded-top-lg" style="border-bottom: 3px dashed #fff;">
            <div class="d-flex justify-content-between align-items-center p-3">
                <div>
                    <h5 class="fw-light mb-0">TRANSAVI</h5>
                    <p class="mb-0 small fst-italic">Tu servicio de transporte confiable</p>
                </div>
                <h1 class="display-5 fw-bold mb-0">BOLETO</h1>
            </div>
        </div>

        <!-- Cuerpo del boleto - Contenido principal -->
        <div class="card-body p-4 bg-white rounded-bottom-lg">
            <div class="row">
                <!-- Seccion izquierda - Detalles del cliente -->
                <div class="col-md-8 border-end pe-4">
                    <h4 class="mb-3 text-warning">Detalles del Pasajero</h4>
                    <div class="row g-2 mb-4">
                        {% if solicitud.tipo_servicio == 'Particular' %}
                            <div class="col-6"><p class="mb-0 small text-muted">NOMBRE COMPLETO</p><p class="fw-bold">{{ solicitud.nombre or '' }} {{ solicitud.primer_apellido or '' }} {{ solicitud.segundo_apellido or '' }}</p></div>
                            <div class="col-6"><p class="mb-0 small text-muted">TELÉFONO</p><p class="fw-bold">{{ solicitud.telefono or '' }}</p></div>
                        {% else %}
                            <div class="col-6"><p class="mb-0 small text-muted">EMPRESA</p><p class="fw-bold">{{ solicitud.nombre_empresa or '' }}</p></div>
                            <div class="col-6"><p class="mb-0 small text-muted">CONTACTO</p><p class="fw-bold">{{ solicitud.nombre_contacto or '' }}</p></div>
                            <div class="col-6"><p class="mb-0 small text-muted">TELÉFONO EMPRESA</p><p class="fw-bold">{{ solicitud.telefono_empresa or '' }}</p></div>
                            <div class="col-6"><p class="mb-0 small text-muted">EMAIL</p><p class="fw-bold">{{ solicitud.email or '' }}</p></div>
                            <div class="col-12"><p class="mb-0 small text-muted">NOTA</p><p class="fw-bold">{{ solicitud.nota or '' }}</p></div>
                        {% endif %}
                    </div>
                    
                    <h4 class="mt-4 mb-3 text-warning">Detalles del Viaje</h4>
                    <div class="row g-2">
                        <div class="col-6"><p class="mb-0 small text-muted">ORIGEN</p><p class="fw-bold">{{ solicitud.lugar_salida or '' }}</p></div>
                        <div class="col-6"><p class="mb-0 small text-muted">DESTINO</p><p class="fw-bold">{{ solicitud.lugar_destino or '' }}</p></div>
                        <div class="col-6"><p class="mb-0 small text-muted">ACTIVIDAD</p><p class="fw-bold">{{ solicitud.actividad or '' }}</p></div>
                        <div class="col-6"><p class="mb-0 small text-muted">FECHA</p><p class="fw-bold">{{ solicitud.fecha_viaje.strftime('%Y-%m-%d') if solicitud.fecha_viaje else '' }}</p></div>
                        <div class="col-6"><p class="mb-0 small text-muted">HORA DE SALIDA</p><p class="fw-bold">{{ solicitud.hora_salida or '' }}</p></div>
                        <div class="col-6"><p class="mb-0 small text-muted">HORA DE RETORNO</p><p class="fw-bold">{{ solicitud.hora_retorno or '' }}</p></div>
                        <div class="col-12"><p class="mb-0 small text-muted">PUNTOS DE ENCUENTRO</p><p class="fw-bold">{{ solicitud.puntos_encuentro or '' }}</p></div>
                    </div>
                </div>

                <!-- Seccion derecha - Código QR y N. de solicitud -->
                <div class="col-md-4 d-flex flex-column align-items-center justify-content-between p-4">
                    <div class="text-center">
                        <h5 class="small text-muted mb-2">SOLICITUD NO.</h5>
                        <h2 class="fw-bold text-warning mb-4">{{ solicitud.numero_solicitud }}</h2>
                        <!-- Código QR real -->
                        <div id="qrcode-container" class="bg-light p-3 border rounded" style="width: 150px; height: 150px;">
                            <canvas id="qrcode-canvas" style="width: 100%; height: 100%;"></canvas>
                        </div>
                        <p class="mt-2 small fst-italic text-muted">Escanee para más detalles</p>
                    </div>
                    <div class="text-center mt-auto">
                        <a href="{{ url_for('solicitud.registro_solicitudes') }}" class="btn btn-warning w-100 mt-3">Volver al Registro</a>
                    </div>
                </div>
            </div>
            
            <!-- Mensaje de cancelación -->
            {% if solicitud.motivo_cancelacion %}
            <hr class="my-4">
            <div class="alert alert-danger text-center mb-0">
                <strong>CANCELADO:</strong> {{ solicitud.motivo_cancelacion }} ({{ solicitud.fecha_cancelacion.strftime('%Y-%m-%d %H:%M:%S') }})
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const solicitudData = {
        'numero_solicitud': '{{ solicitud.numero_solicitud }}',
        'url_detalles': '{{ url_for("solicitud.ver_detalle_solicitud", solicitud_id=solicitud.id, _external=True) }}'
    };

    const qrcode = new QRCode(document.getElementById("qrcode-canvas"), {
        text: JSON.stringify(solicitudData),
        width: 128,
        height: 128,
        colorDark : "#000000",
        colorLight : "#ffffff",
        correctLevel : QRCode.CorrectLevel.H
    });
});
</script>
{% endblock %}

{% extends "base.html" %}

{% block title %}Crear Nuevo Viaje Internacional{% endblock %}

{% block head_content %}
<style>
    .card {
        box-shadow: none !important;
        border: 1px solid #dee2e6;
    }
    .form-section-separator {
        border-top: 2px solid #ffc107;
        margin-top: 2rem;
        margin-bottom: 2rem;
    }
    .dynamic-item {
        border-left: 3px solid #ffc107;
        padding-left: 15px;
        margin-bottom: 1rem;
    }
    .fab-container-back {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 1000;
    }
    .fab-button {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
        text-decoration: none;
    }
    .fab-button:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    .airline-fields {
        display: none; /* Oculto por defecto */
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4 text-center">Crear Nuevo Viaje Internacional</h1>

    <form action="{{ url_for('intern.crear_intern') }}" method="POST" enctype="multipart/form-data">
        
        <!-- SECCIÓN DESTINO -->
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h4 class="mb-0">Destino</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="titulo_destino" class="form-label">Título Destino</label>
                        <input type="text" class="form-control" id="titulo_destino" name="titulo_destino" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="nombre_viaje" class="form-label">Nombre del Viaje</label>
                        <input type="text" class="form-control" id="nombre_viaje" name="nombre_viaje" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="flyer" class="form-label">Flyer (Imagen)</label>
                        <input type="file" class="form-control" id="flyer" name="flyer" accept="image/*">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="pais" class="form-label">País</label>
                        <select class="form-select" id="pais" name="pais" required>
                            <option selected disabled value="">Seleccionar país...</option>
                            <option value="Panama">Panamá</option>
                            <option value="Nicaragua">Nicaragua</option>
                            <option value="Honduras">Honduras</option>
                            <option value="El Salvador">El Salvador</option>
                            <option value="Guatemala">Guatemala</option>
                            <option value="Mexico">México</option>
                            <option value="Peru">Perú</option>
                            <option value="Spain">España</option>
                        </select>
                    </div>
                </div>
                 <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="precio_paquete" class="form-label">Precio del Paquete</label>
                        <input type="number" step="0.01" class="form-control" id="precio_paquete" name="precio_paquete" value="0">
                    </div>
                    <div class="col-md-2 mb-3">
                        <label for="capacidad" class="form-label">Capacidad</label>
                        <input type="number" class="form-control" id="capacidad" name="capacidad" value="0">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="tipo_moneda" class="form-label">Tipo de Moneda</label>
                        <select class="form-select" id="tipo_moneda" name="tipo_moneda">
                            <option value="CRC">Colones (CRC)</option>
                            <option value="USD">Dólares (USD)</option>
                        </select>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="tipo_cambio" class="form-label">Tipo de Cambio (a USD)</label>
                        <input type="number" step="0.01" class="form-control" id="tipo_cambio" name="tipo_cambio" value="520.00">
                    </div>
                </div>
            </div>
        </div>

        <!-- SEPARADOR ADMINISTRACIÓN DE VIAJE -->
        <hr class="form-section-separator">
        <h2 class="text-center mb-4">Administración de Viaje</h2>

        <!-- SECCIÓN PRE-ALERTA -->
        <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Pre-Alerta Bancaria</h5>
                <button type="button" class="btn btn-sm btn-outline-warning" onclick="addDynamicForm('prealerta-container', 'prealerta-template')">
                    <i class="fas fa-plus"></i> Agregar Pre-Alerta
                </button>
            </div>
            <div class="card-body" id="prealerta-container"></div>
        </div>

        <!-- SEPARADOR LUGARES A VISITAR -->
        <hr class="form-section-separator">
        <h2 class="text-center mb-4">Lugares a Visitar</h2>
        <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Atracciones</h5>
                 <button type="button" class="btn btn-sm btn-outline-warning" onclick="addDynamicForm('lugar-container', 'lugar-template')">
                    <i class="fas fa-plus"></i> Agregar Lugar
                </button>
            </div>
            <div class="card-body" id="lugar-container"></div>
            <div class="card-footer bg-light">
                <strong>TOTAL DE ATRACCIONES: <span id="total-atracciones">0.00</span> CRC</strong>
            </div>
        </div>

        <!-- SEPARADOR TRANSPORTES -->
        <hr class="form-section-separator">
        <h2 class="text-center mb-4">Transportes</h2>
        <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Transporte Local</h5>
                 <button type="button" class="btn btn-sm btn-outline-warning" onclick="addDynamicForm('transporte-container', 'transporte-template')">
                    <i class="fas fa-plus"></i> Agregar Transporte
                </button>
            </div>
            <div class="card-body" id="transporte-container"></div>
            <div class="card-footer bg-light">
                <strong>TOTAL DE TRANSPORTE: <span id="total-transporte">0.00</span> CRC</strong>
            </div>
        </div>
        
        <!-- SEPARADOR GUÍAS -->
        <hr class="form-section-separator">
        <h2 class="text-center mb-4">Guías</h2>
        <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Guías Turísticos</h5>
                 <button type="button" class="btn btn-sm btn-outline-warning" onclick="addDynamicForm('guia-container', 'guia-template')">
                    <i class="fas fa-plus"></i> Agregar Guía
                </button>
            </div>
            <div class="card-body" id="guia-container"></div>
            <div class="card-footer bg-light">
                <strong>TOTAL DE GUÍAS POR PERSONA: <span id="total-guias">0.00</span> CRC</strong>
            </div>
        </div>

        <!-- SEPARADOR ESTADÍAS -->
        <hr class="form-section-separator">
        <h2 class="text-center mb-4">Estadías</h2>
        <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Hospedaje</h5>
                 <button type="button" class="btn btn-sm btn-outline-warning" onclick="addDynamicForm('estadia-container', 'estadia-template')">
                    <i class="fas fa-plus"></i> Agregar Estadía
                </button>
            </div>
            <div class="card-body" id="estadia-container"></div>
            <div class="card-footer bg-light">
                <strong>TOTAL DE ESTADÍA POR PERSONA: <span id="total-estadia">0.00</span> CRC</strong>
            </div>
        </div>

        <!-- SEPARADOR AEROLINEA -->
        <hr class="form-section-separator">
        <h2 class="text-center mb-4">Aerolínea / Transporte Principal</h2>
        <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Transporte Principal</h5>
                 <button type="button" class="btn btn-sm btn-outline-warning" onclick="addDynamicForm('aerolinea-container', 'aerolinea-template')">
                    <i class="fas fa-plus"></i> Agregar Aerolínea/Transporte
                </button>
            </div>
            <div class="card-body" id="aerolinea-container"></div>
            <div class="card-footer bg-light">
                <strong>TOTAL DE AEROLÍNEA POR PERSONA: <span id="total-aerolinea">0.00</span> CRC</strong>
            </div>
        </div>

        <!-- TOTALES GENERALES -->
        <div class="card mt-5">
            <div class="card-header bg-dark text-white">
                <h3 class="mb-0">Totales Individuales Estimados</h3>
            </div>
            <div class="card-body fs-5">
                <div class="row">
                    <div class="col-md-6">
                        <strong>TOTAL INDIVIDUAL CRC:</strong>
                        <p class="text-success fw-bold" id="total-individual-crc">0.00 CRC</p>
                    </div>
                    <div class="col-md-6">
                        <strong>TOTAL INDIVIDUAL USD:</strong>
                        <p class="text-primary fw-bold" id="total-individual-usd">0.00 USD</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-grid gap-2 mt-4 mb-5">
            <button type="submit" class="btn btn-warning btn-lg">Crear Viaje</button>
        </div>
    </form>
</div>

<!-- BOTÓN FLOTANTE DE VOLVER -->
<div class="fab-container-back">
    <a href="{{ url_for('intern.ver_intern') }}" class="btn btn-secondary fab-button" title="Volver al listado">
        <i class="fas fa-arrow-left"></i>
    </a>
</div>

<!-- =========== TEMPLATES PARA FORMULARIOS DINÁMICOS =========== -->
<template id="prealerta-template">
    <div class="dynamic-item p-3 mb-3 border rounded">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Pre-Alerta #<span class="item-number">1</span></h6>
            <button type="button" class="btn-close" aria-label="Close" onclick="this.closest('.dynamic-item').remove()"></button>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Entidad Financiera</label>
                <select name="prealerta_banco[]" class="form-select">
                    <option selected disabled value="">Seleccionar...</option>
                    <option>Banco de Costa Rica (BCR)</option>
                    <option>Banco Nacional de Costa Rica (BNCR)</option>
                    <option>Banco Popular</option>
                    <option>Mucap</option>
                    <option>Mutual</option>
                    <option>BAC Credomatic</option>
                    <option>Banco Cathay</option>
                    <option>Banco BCT</option>
                    <option>Banco CMB</option>
                    <option>Banco Davivienda</option>
                    <option>Banco General</option>
                    <option>Banco Improsa</option>
                    <option>Banco Lafise</option>
                    <option>Banco Promérica</option>
                    <option>Prival Bank</option>
                    <option>Scotiabank</option>
                    <option>Coopealianza</option>
                    <option>Coopeande</option>
                    <option>CoopeAnde No. 1</option>
                    <option>CoopeAnde No. 2</option>
                    <option>CoopeAnde No. 3</option>
                    <option>CoopeAnde No. 4</option>
                    <option>CoopeAnde No. 5</option>
                    <option>CoopeAnde No. 6</option>
                    <option>CoopeAnde No. 7</option>
                    <option>CoopeAnde No. 8</option>
                    <option>CoopeAnde No. 9</option>
                    <option>CoopeAnde No. 10</option>
                    <option>CoopeAnde No. 11</option>
                    <option>CoopeCaja</option>
                    <option>Caja de ANDE</option>
                    <option>COOPENAE</option>
                    <option>COOPEUCHA</option>
                    <option>COOPESANRAMON</option>
                    <option>COOPESERVIDORES</option>
                    <option>COOPEUNA</option>
                    <option>CREDECOOP</option>
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Teléfono Entidad Financiera</label>
                <input type="tel" name="prealerta_telefono[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Fecha de la prealerta</label>
                <input type="date" name="prealerta_fecha[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Nombre del Asesor Bancario</label>
                <input type="text" name="prealerta_asesor[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Hora de la Prealerta</label>
                <input type="time" name="prealerta_hora[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Número de la prealerta</label>
                <input type="text" name="prealerta_numero[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Fecha prealertada (Desde)</label>
                <input type="date" name="prealerta_desde[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Fecha prealertada (Hasta)</label>
                <input type="date" name="prealerta_hasta[]" class="form-control">
            </div>
        </div>
    </div>
</template>

<template id="lugar-template">
    <div class="dynamic-item p-3 mb-3 border rounded">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Lugar #<span class="item-number">1</span></h6>
            <button type="button" class="btn-close" aria-label="Close" onclick="this.closest('.dynamic-item').remove(); calculateTotals();"></button>
        </div>
        <div class="row">
            <div class="col-md-4 mb-3">
                <label class="form-label">Tipo</label>
                <select name="lugar_tipo[]" class="form-select">
                    <option>Volcán</option><option>Montaña</option><option>Playa</option><option>Ciudad</option><option>Parque Nacional</option><option>Camino</option><option>Otros</option>
                </select>
            </div>
            <div class="col-md-8 mb-3">
                <label class="form-label">Nombre del Sitio</label>
                <input type="text" name="lugar_nombre[]" class="form-control">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Precio Entrada (CRC)</label>
                <input type="number" step="0.01" name="lugar_precio[]" class="form-control price-field" value="0" oninput="calculateTotals()">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Fecha Reserva</label>
                <input type="date" name="lugar_fecha_reserva[]" class="form-control">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Guía Local</label>
                <select name="lugar_guia_local[]" class="form-select">
                    <option value="No">No</option>
                    <option value="Si">Si</option>
                </select>
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Nombre Guía</label>
                <input type="text" name="lugar_nombre_guia[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Teléfono del Lugar</label>
                <input type="tel" name="lugar_telefono_lugar[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Teléfono del Contacto</label>
                <input type="tel" name="lugar_telefono_contacto[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Whatsapp del Contacto</label>
                <input type="tel" name="lugar_whatsapp_contacto[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="lugar_email[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Enlaces</label>
                <input type="text" name="lugar_enlaces[]" class="form-control">
            </div>
            <div class="col-12 mb-3">
                <label class="form-label">Nota</label>
                <textarea name="lugar_nota[]" class="form-control" rows="2"></textarea>
            </div>
        </div>
    </div>
</template>

<template id="transporte-template">
     <div class="dynamic-item p-3 mb-3 border rounded">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Transporte #<span class="item-number">1</span></h6>
            <button type="button" class="btn-close" aria-label="Close" onclick="this.closest('.dynamic-item').remove(); calculateTotals();"></button>
        </div>
        <div class="row">
            <div class="col-md-4 mb-3">
                <label class="form-label">Tipo</label>
                <select name="transporte_tipo[]" class="form-select">
                    <option>Buseta</option><option>Bus</option><option>Taxi</option><option>Uber</option><option>Auto</option><option>Lancha</option><option>Avión</option>
                </select>
            </div>
            <div class="col-md-8 mb-3">
                <label class="form-label">Nombre del Transporte</label>
                <input type="text" name="transporte_nombre[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Precio del Transporte (CRC)</label>
                <input type="number" step="0.01" name="transporte_precio[]" class="form-control price-field" value="0" oninput="calculateTotals()">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Nombre Conductor</label>
                <input type="text" name="transporte_conductor[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Fecha Contratación</label>
                <input type="date" name="transporte_fecha_contratacion[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Teléfono del Lugar</label>
                <input type="tel" name="transporte_telefono_lugar[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Teléfono del contacto</label>
                <input type="tel" name="transporte_telefono_contacto[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Whatsapp del Contacto</label>
                <input type="tel" name="transporte_whatsapp_contacto[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="transporte_email[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Enlaces</label>
                <input type="text" name="transporte_enlaces[]" class="form-control">
            </div>
            <div class="col-12 mb-3">
                <label class="form-label">Nota</label>
                <textarea name="transporte_nota[]" class="form-control" rows="2"></textarea>
            </div>
        </div>
    </div>
</template>

<template id="guia-template">
    <div class="dynamic-item p-3 mb-3 border rounded">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Guía #<span class="item-number">1</span></h6>
            <button type="button" class="btn-close" aria-label="Close" onclick="this.closest('.dynamic-item').remove(); calculateTotals();"></button>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" name="guia_nombre[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Teléfono</label>
                <input type="tel" name="guia_telefono[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Operador</label>
                <input type="text" name="guia_operador[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="guia_email[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Whatsapp</label>
                <input type="tel" name="guia_whatsapp[]" class="form-control">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Precio Guía PP (CRC)</label>
                <input type="number" step="0.01" name="guia_precio_pp[]" class="form-control price-field" value="0" oninput="calculateTotals()">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Precio Acarreo (CRC)</label>
                <input type="number" step="0.01" name="guia_precio_acarreo[]" class="form-control price-field" value="0" oninput="calculateTotals()">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">CPL</label>
                <select name="guia_cpl[]" class="form-select">
                    <option value="No">No</option>
                    <option value="Si">Si</option>
                </select>
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Fecha Disponible</label>
                <input type="date" name="guia_fecha_disponible[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Reserva</label>
                <input type="text" name="guia_reserva[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Fecha Reserva</label>
                <input type="date" name="guia_fecha_reserva[]" class="form-control">
            </div>
            <div class="col-md-12 mb-3">
                <label class="form-label">Enlaces</label>
                <input type="text" name="guia_enlaces[]" class="form-control">
            </div>
            <div class="col-12 mb-3">
                <label class="form-label">Nota</label>
                <textarea name="guia_nota[]" class="form-control" rows="2"></textarea>
            </div>
        </div>
    </div>
</template>

<template id="estadia-template">
     <div class="dynamic-item p-3 mb-3 border rounded">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Estadía #<span class="item-number">1</span></h6>
            <button type="button" class="btn-close" aria-label="Close" onclick="this.closest('.dynamic-item').remove(); calculateTotals();"></button>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" name="estadia_nombre[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Contacto</label>
                <input type="text" name="estadia_contacto[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Teléfono</label>
                <input type="tel" name="estadia_telefono[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Whatsapp</label>
                <input type="tel" name="estadia_whatsapp[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="estadia_email[]" class="form-control">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Precio PP por Noche (CRC)</label>
                <input type="number" step="0.01" name="estadia_precio_pp[]" class="form-control price-field" value="0" oninput="calculateTotals()">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Cantidad de Noches</label>
                <input type="number" name="estadia_noches[]" class="form-control" value="1" oninput="calculateTotals()">
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">CPL</label>
                <select name="estadia_cpl[]" class="form-select">
                    <option value="No">No</option>
                    <option value="Si">Si</option>
                </select>
            </div>
            <div class="col-md-3 mb-3">
                <label class="form-label">Alimentación Incluida</label>
                <select name="estadia_alimentacion[]" class="form-select">
                    <option value="No">No</option>
                    <option value="Si">Si</option>
                </select>
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Fecha Disponible Reserva</label>
                <input type="date" name="estadia_fecha_disponible[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Fecha Entrada</label>
                <input type="date" name="estadia_fecha_entrada[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Fecha Salida</label>
                <input type="date" name="estadia_fecha_salida[]" class="form-control">
            </div>
            <div class="col-12 mb-3">
                <label class="form-label">Enlaces</label>
                <input type="text" name="estadia_enlaces[]" class="form-control">
            </div>
            <div class="col-12 mb-3">
                <label class="form-label">Nota</label>
                <textarea name="estadia_nota[]" class="form-control" rows="2"></textarea>
            </div>
        </div>
    </div>
</template>

<template id="aerolinea-template">
     <div class="dynamic-item p-3 mb-3 border rounded">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Aerolínea/Transporte #<span class="item-number">1</span></h6>
            <button type="button" class="btn-close" aria-label="Close" onclick="this.closest('.dynamic-item').remove(); calculateTotals();"></button>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Tipo de Transporte</label>
                <select name="aerolinea_tipo_transporte[]" class="form-select" onchange="toggleAirlineFields(this)">
                    <option>Bus</option><option>Buseta</option><option>Auto</option><option>Moto</option><option>Barco</option><option>Avión</option>
                </select>
            </div>
        </div>
        <div class="row airline-fields">
            <div class="col-md-6 mb-3">
                <label class="form-label">Aerolínea</label>
                <select name="aerolinea_nombre[]" class="form-select">
                    <option>Avianca</option><option>American Airlines</option><option>Copa</option><option>Volaris</option><option>Jetblue</option><option>Sansa</option><option>Spirit</option><option>United</option><option>Wingo</option><option>KLM</option><option>Iberia</option><option>Lufthansa</option><option>Latam Airlines</option><option>IberoJet</option><option>Delta</option><option>AirFrance</option><option>Alaska</option><option>AeroMéxico</option><option>Arajet</option><option>Air Canadá</option><option>Airtransat</option><option>Green Airways</option><option>Southwest</option><option>Edelweiss</option><option>Frontier</option><option>GOL</option>
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Teléfono Aerolínea</label>
                <input type="tel" name="aerolinea_telefono[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Email</label>
                <input type="email" name="aerolinea_email[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Whatsapp</label>
                <input type="tel" name="aerolinea_whatsapp[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Fecha de Pre-alerta</label>
                <input type="date" name="aerolinea_fecha_prealerta[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Enlace para Pre-alerta</label>
                <input type="text" name="aerolinea_enlace_prealerta[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Número de Vuelo</label>
                <input type="text" name="aerolinea_num_vuelo[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Horario de Salida</label>
                <input type="time" name="aerolinea_hora_salida[]" class="form-control">
            </div>
            <div class="col-md-4 mb-3">
                <label class="form-label">Horario de Llegada</label>
                <input type="time" name="aerolinea_hora_llegada[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Nombre del Aeropuerto</label>
                <input type="text" name="aerolinea_aeropuerto[]" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label">Teléfono del Aeropuerto</label>
                <input type="tel" name="aerolinea_tel_aeropuerto[]" class="form-control">
            </div>
            <hr>
            <h6 class="text-center">Precios</h6>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Asientos</label><input type="number" name="aerolinea_p_asientos[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Maletas Doc.</label><input type="number" name="aerolinea_p_maletas[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Equipaje de Mano</label><input type="number" name="aerolinea_p_equipaje_mano[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Estandar</label><input type="number" name="aerolinea_p_estandar[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Mas equipo</label><input type="number" name="aerolinea_p_mas_equipo[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Salida rápida</label><input type="number" name="aerolinea_p_salida_rapida[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Premium</label><input type="number" name="aerolinea_p_premium[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio VIP</label><input type="number" name="aerolinea_p_vip[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Basic</label><input type="number" name="aerolinea_p_basic[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Classic</label><input type="number" name="aerolinea_p_classic[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Flexible</label><input type="number" name="aerolinea_p_flexible[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Precio Impuestos</label><input type="number" name="aerolinea_p_impuestos[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <hr>
            <h6 class="text-center">Otros Costos</h6>
            {% for i in range(1, 5) %}
            <div class="col-md-6 mb-3"><label class="form-label">Descripción #{{i}}</label><input type="text" name="aerolinea_desc_{{i}}[]" class="form-control"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Otros Costos #{{i}}</label><input type="number" name="aerolinea_costo_{{i}}[]" class="form-control price-field" value="0" oninput="calculateTotals()"></div>
            <div class="col-md-3 mb-3"><label class="form-label">Cantidad</label><input type="number" name="aerolinea_cant_{{i}}[]" class="form-control" value="1"></div>
            {% endfor %}
            <hr>
            <div class="col-md-6 mb-3">
                <label class="form-label">Fecha de Compra</label>
                <input type="date" name="aerolinea_fecha_compra[]" class="form-control">
            </div>
        </div>
    </div>
</template>

{% endblock %}

{% block scripts %}
<script>
    function addDynamicForm(containerId, templateId) {
        const container = document.getElementById(containerId);
        const template = document.getElementById(templateId);
        const clone = template.content.cloneNode(true);
        const itemNumber = container.children.length + 1;
        clone.querySelector('.item-number').textContent = itemNumber;
        container.appendChild(clone);
    }

    function toggleAirlineFields(selectElement) {
        const parentItem = selectElement.closest('.dynamic-item');
        const airlineFields = parentItem.querySelector('.airline-fields');
        if (selectElement.value === 'Avión') {
            airlineFields.style.display = 'flex'; // O 'grid', o lo que corresponda
        } else {
            airlineFields.style.display = 'none';
        }
    }

    function calculateTotals() {
        let totalAtracciones = 0;
        document.querySelectorAll('#lugar-container .price-field').forEach(input => {
            totalAtracciones += parseFloat(input.value) || 0;
        });
        document.getElementById('total-atracciones').textContent = totalAtracciones.toFixed(2);

        let totalTransporte = 0;
        document.querySelectorAll('#transporte-container .price-field').forEach(input => {
            totalTransporte += parseFloat(input.value) || 0;
        });
        document.getElementById('total-transporte').textContent = totalTransporte.toFixed(2);
        
        let totalGuias = 0;
        document.querySelectorAll('#guia-container .dynamic-item').forEach(item => {
            const precioPP = parseFloat(item.querySelector('input[name="guia_precio_pp[]"]').value) || 0;
            const precioAcarreo = parseFloat(item.querySelector('input[name="guia_precio_acarreo[]"]').value) || 0;
            totalGuias += precioPP + precioAcarreo;
        });
        document.getElementById('total-guias').textContent = totalGuias.toFixed(2);

        let totalEstadia = 0;
        document.querySelectorAll('#estadia-container .dynamic-item').forEach(item => {
            const precioPP = parseFloat(item.querySelector('input[name="estadia_precio_pp[]"]').value) || 0;
            const noches = parseInt(item.querySelector('input[name="estadia_noches[]"]').value) || 1;
            totalEstadia += precioPP * noches;
        });
        document.getElementById('total-estadia').textContent = totalEstadia.toFixed(2);

        let totalAerolinea = 0;
        document.querySelectorAll('#aerolinea-container .price-field').forEach(input => {
            const parentItem = input.closest('.dynamic-item');
            const cantidadInput = parentItem.querySelector(`input[name="${input.name.replace('costo', 'cant')}"]`);
            const cantidad = cantidadInput ? (parseInt(cantidadInput.value) || 1) : 1;
            totalAerolinea += (parseFloat(input.value) || 0) * cantidad;
        });
        document.getElementById('total-aerolinea').textContent = totalAerolinea.toFixed(2);
        
        const totalIndividualCRC = totalAtracciones + totalTransporte + totalGuias + totalEstadia + totalAerolinea;
        document.getElementById('total-individual-crc').textContent = totalIndividualCRC.toFixed(2) + ' CRC';

        const tipoCambio = parseFloat(document.getElementById('tipo_cambio').value) || 1;
        const totalIndividualUSD = totalIndividualCRC / tipoCambio;
        document.getElementById('total-individual-usd').textContent = totalIndividualUSD.toFixed(2) + ' USD';
    }
    
    document.getElementById('tipo_cambio').addEventListener('input', calculateTotals);
</script>
{% endblock %}
